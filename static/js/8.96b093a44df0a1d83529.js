webpackJsonp([8],{Qqu7:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});a("eqfM");var o,i=a("/QYm"),n={data:function(){return{hheader:{title:"基坑监测项目"},imgList:[],count:0,isLoading:!1,list:[],loading:!1,finished:!1,projectId:"",pageNumber:0,totalPage:0,upload:!0}},created:function(){this.projectId=HGetHashUrl("projectId"),this.init();var e=this;o=setInterval(function(){console.log("文件值"+e.$refs.referenceUpload.value+"<<<<是否允许上传???>>>"+e.upload),$("#imageFile").val()&&e.upload&&(console.log("触发上传"),e.applay())},100)},methods:{onRefresh:function(){var e=this;setTimeout(function(){e.totalPage=0,e.pageNumber=0,e.init()},500)},onLoad:function(){var e=this;setTimeout(function(){var t={projectId:HGetHashUrl("projectId"),pageNumber:e.pageNumber+1};e.$.Get("/project/imgShow",t,function(t){e.totalPage=t.info.totalPage,e.imgList=e.imgList.concat(t.info.list),e.loading=!1,e.pageNumber++,e.pageNumber>=e.totalPage&&(e.finished=!0)})},500)},submintPhoto:function(){document.getElementById("imageFile").click()},applay:function(){var e=this;if(console.log("图片》》》》"+e.projectId),!$("#imageFile").val())return!1;e.upload=!1,console.log("上传图片"),$.ajaxFileUpload({url:"/project/uploadpic?projectId="+e.projectId,secureuri:!1,fileElementId:"imageFile",dataType:"json",data:{projectId:e.projectId},success:function(t,a){Object(i.a)("上传成功"),$("#imageFile").val(""),e.upload=!0,"success"==t.flag&&(e.totalPage=0,e.pageNumber=0,e.init())},error:function(t,a){$("#imageFile").val(""),alert("上传失败"),e.upload=!0}})},init:function(){var e=this,t={projectId:HGetHashUrl("projectId"),pageNumber:e.pageNumber+1};e.$.Get("/project/imgShow",t,function(t){console.log(t),e.imgList=t.info.list,e.totalPage=t.info.totalPage,e.isLoading=!1})}},beforeDestroy:function(){clearInterval(o)}};var r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"photo"},[a("hheader",{attrs:{header:e.hheader}},[a("span",{attrs:{slot:"hright"},on:{click:e.submintPhoto},slot:"hright"},[e._v("上传图片")])]),e._v(" "),a("section",{staticClass:"container has-header has-gray has-footer"},[a("van-pull-refresh",{on:{refresh:e.onRefresh},model:{value:e.isLoading,callback:function(t){e.isLoading=t},expression:"isLoading"}},[a("van-list",{attrs:{finished:e.finished},on:{load:e.onLoad},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},[a("ul",{staticClass:"photo-ul"},e._l(e.imgList,function(t){return a("li",{staticClass:"photo-item"},[a("div",{staticClass:"item-top"},[a("img",{attrs:{src:t.address,alt:""}})]),e._v(" "),a("h4",[e._v(e._s(t.photo_name))])])})),e._v(" "),a("div",{staticClass:"hhfrom",attrs:{action:"/apis/project/uploadpic",enctype:"multipart/form-data",method:"post",id:"hform",target:"iframe"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.projectId,expression:"projectId"}],attrs:{type:"hidden",name:"projectId"},domProps:{value:e.projectId},on:{input:function(t){t.target.composing||(e.projectId=t.target.value)}}}),e._v(" "),a("van-button",{staticClass:"file",attrs:{type:"primary",id:"imageFileParent"}},[e._v("上传照片\n                        "),a("input",{ref:"referenceUpload",attrs:{type:"file",name:"imgFile",id:"imageFile"}})])],1),e._v(" "),a("iframe",{attrs:{frameborder:"0",id:"iframe",name:"iframe"}})])],1)],1),e._v(" "),a("hfooter")],1)},staticRenderFns:[]};var s=a("VU/8")(n,r,!1,function(e){a("SuS5")},null,null);t.default=s.exports},SuS5:function(e,t){}});
//# sourceMappingURL=8.96b093a44df0a1d83529.js.map